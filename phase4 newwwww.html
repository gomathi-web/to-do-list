<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Todo App â€” Demo (Login, Signup, Lists, Calendar, Drag & Drop)</title>
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--accent:#06b6d4;--muted:#94a3b8;--ok:#10b981}
    *{box-sizing:border-box;font-family:Inter,system-ui,Segoe UI,Roboto,'Helvetica Neue',Arial}
    body{margin:0;background:linear-gradient(180deg,#071025 0%, #07112a 60%);color:#e6eef6}
    header{display:flex;align-items:center;justify-content:space-between;padding:14px 18px;border-bottom:1px solid rgba(255,255,255,0.03)}
    h1{font-size:18px;margin:0}
    .container{display:grid;grid-template-columns:260px 1fr 320px;gap:18px;padding:18px}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:14px;border-radius:12px;box-shadow:0 6px 20px rgba(2,6,23,0.6)}

    /* sidebar */
    .sidebar{height:calc(100vh - 92px);overflow:auto}
    .user-box{display:flex;gap:12px;align-items:center}
    .avatar{width:44px;height:44px;border-radius:10px;background:linear-gradient(180deg,#0ea5a5,#0ea5b8);display:flex;align-items:center;justify-content:center;font-weight:700}
    .small{font-size:13px;color:var(--muted)}
    .lists{margin-top:12px}
    .lists button{display:block;width:100%;text-align:left;padding:8px;border-radius:8px;border:0;background:transparent;color:inherit}
    .lists button:hover{background:rgba(255,255,255,0.02)}
    .add-btn{display:inline-block;padding:8px 10px;border-radius:8px;background:rgba(255,255,255,0.03);cursor:pointer;border:1px dashed rgba(255,255,255,0.03)}

    /* main content */
    .main{height:calc(100vh - 132px);overflow:auto}
    .toolbar{display:flex;gap:8px;align-items:center;margin-bottom:12px}
    input[type=text], input[type=password], input[type=date], select{padding:8px;border-radius:8px;border:0;background:rgba(255,255,255,0.02);color:inherit}
    .lists-grid{display:flex;gap:12px}
    .list{min-width:260px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));padding:10px;border-radius:10px}
    .list h3{display:flex;justify-content:space-between;align-items:center;margin:0 0 8px 0}
    .task{display:flex;align-items:center;gap:8px;padding:8px;border-radius:8px;margin-bottom:8px;background:rgba(255,255,255,0.01);cursor:grab}
    .task.dragging{opacity:0.6}
    .task .title{flex:1}
    .task .meta{font-size:12px;color:var(--muted)}
    .checkbox{width:18px;height:18px;border-radius:4px;border:2px solid rgba(255,255,255,0.06);display:inline-block}

    /* right column */
    .calendar{padding:8px}
    .calendar input[type=date]{width:100%}
    .quicklist{margin-top:12px}
    .btn{padding:8px 12px;border-radius:8px;background:var(--accent);color:#022;cursor:pointer;border:0}
    .ghost{background:transparent;border:1px solid rgba(255,255,255,0.03)}

    /* login/signup overlay */
    .overlay{position:fixed;inset:0;background:linear-gradient(90deg,rgba(0,0,0,0.6),rgba(0,0,0,0.6));display:flex;align-items:center;justify-content:center}
    .modal{width:380px;background:var(--card);padding:18px;border-radius:12px}
    .field{margin-bottom:10px}
    .muted{color:var(--muted);font-size:13px}

    /* small */
    .small-button{font-size:13px;padding:6px 8px;border-radius:8px}

    @media (max-width:980px){.container{grid-template-columns:1fr}.calendar{display:none}}
  </style>
</head>
<body>
  <header>
    <div style="display:flex;align-items:center;gap:12px">
      <h1>Simple TODO â€” Demo</h1>
      <div class="small muted">Features: calendar, due dates, drag & drop, lists, login/signup (local), quicklist</div>
    </div>
    <div style="display:flex;gap:8px;align-items:center">
      <button id="btn-guest" class="small-button ghost">Continue as Guest</button>
      <button id="btn-login" class="small-button">Login / Signup</button>
    </div>
  </header>

  <div class="container">
    <!-- Sidebar -->
    <aside class="card sidebar">
      <div class="user-box">
        <div class="avatar" id="avatarText">G</div>
        <div>
          <div id="displayName">Guest</div>
          <div class="small muted" id="displayEmail">Not signed in</div>
        </div>
      </div>

      <div style="display:flex;justify-content:space-between;align-items:center;margin-top:12px">
        <div class="small muted">Your Lists</div>
        <div class="add-btn" id="addListBtn">+ New</div>
      </div>

      <div class="lists" id="listsContainer"></div>

      <hr style="opacity:0.05;margin:12px 0">
      <div class="small muted">Optional accounts (local demo)</div>
      <div style="margin-top:8px">
        <div class="small muted">Store in browser. No server used. For real app use secure backend & hashed passwords.</div>
      </div>
    </aside>

    <!-- Main -->
    <main class="card main">
      <div class="toolbar">
        <input id="taskText" type="text" placeholder="Add a task (press Enter)" style="flex:1">
        <input id="dueDate" type="date">
        <select id="taskListSelect"></select>
        <button id="addTaskBtn" class="btn">Add</button>
      </div>

      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <div style="display:flex;gap:8px;align-items:center">
          <button id="showAll" class="small-button ghost">All</button>
          <button id="showToday" class="small-button ghost">Today</button>
          <button id="showDueSoon" class="small-button ghost">Due Soon</button>
        </div>
        <div class="muted">Drag tasks between lists or reorder</div>
      </div>

      <div class="lists-grid" id="listsGrid"></div>

    </main>

    <!-- Right column: calendar, quicklist -->
    <aside class="card" style="height:calc(100vh - 92px);overflow:auto">
      <div class="calendar">
        <div class="small muted">Calendar (pick a date to filter)</div>
        <input id="calendarDate" type="date">
        <div id="calendarList" style="margin-top:10px"></div>
      </div>

      <div class="quicklist">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div class="small muted">Quick Lists</div>
          <button id="addQuick" class="small-button">+ Add</button>
        </div>
        <div style="margin-top:8px">
          <button class="small-button ghost" data-quick="Shopping">Shopping</button>
          <button class="small-button ghost" data-quick="Work">Work</button>
          <button class="small-button ghost" data-quick="Chores">Chores</button>
        </div>
      </div>
    </aside>
  </div>

  <!-- Login / Signup modal -->
  <div id="authOverlay" class="overlay" style="display:none">
    <div class="modal">
      <h3 id="authTitle">Login</h3>
      <div class="field"><input id="authEmail" type="text" placeholder="Email or username" style="width:100%"></div>
      <div class="field"><input id="authPassword" type="password" placeholder="Password" style="width:100%"></div>
      <div style="display:flex;gap:8px;justify-content:flex-end">
        <button id="switchAuth" class="small-button ghost">Switch to Signup</button>
        <button id="authSubmit" class="btn">Login</button>
      </div>
      <div style="margin-top:10px" class="muted">Demo stores accounts in localStorage. Use simple passwords only for demo.</div>
    </div>
  </div>

  <script>
    /* Simple in-browser demo app. Not production-ready. Passwords stored plaintext only for demo. */

    // --- Data & persistence ---
    const DB_KEY = 'todo_demo_v1';

    function loadDB(){
      const raw = localStorage.getItem(DB_KEY);
      if(!raw){
        const seed = {users:[], currentUser:null, lists:{}, listOrder:[]};
        localStorage.setItem(DB_KEY, JSON.stringify(seed));
        return seed;
      }
      return JSON.parse(raw);
    }
    function saveDB(db){ localStorage.setItem(DB_KEY, JSON.stringify(db)); }

    let db = loadDB();

    // --- sample initial list if empty ---
    if(Object.keys(db.lists).length === 0){
      const id = genId();
      db.listOrder.push(id);
      db.lists[id] = {id, name:'Inbox', tasks:[]};
      saveDB(db);
    }

    // --- utilities ---
    function genId(){return 'id_'+Math.random().toString(36).slice(2,9)}
    function formatDate(d){ if(!d) return '';
      const dt = new Date(d); if(isNaN(dt)) return '';
      return dt.toLocaleDateString();
    }

    // --- elements ---
    const listsContainer = document.getElementById('listsContainer');
    const listsGrid = document.getElementById('listsGrid');
    const taskText = document.getElementById('taskText');
    const dueDate = document.getElementById('dueDate');
    const taskListSelect = document.getElementById('taskListSelect');
    const addTaskBtn = document.getElementById('addTaskBtn');
    const addListBtn = document.getElementById('addListBtn');
    const displayName = document.getElementById('displayName');
    const displayEmail = document.getElementById('displayEmail');
    const avatarText = document.getElementById('avatarText');
    const btnLogin = document.getElementById('btn-login');
    const btnGuest = document.getElementById('btn-guest');
    const authOverlay = document.getElementById('authOverlay');
    const authTitle = document.getElementById('authTitle');
    const authEmail = document.getElementById('authEmail');
    const authPassword = document.getElementById('authPassword');
    const authSubmit = document.getElementById('authSubmit');
    const switchAuth = document.getElementById('switchAuth');
    const calendarDate = document.getElementById('calendarDate');
    const calendarList = document.getElementById('calendarList');
    const showAll = document.getElementById('showAll');
    const showToday = document.getElementById('showToday');
    const showDueSoon = document.getElementById('showDueSoon');
    const addQuick = document.getElementById('addQuick');

    // --- auth flow ---
    let authMode = 'login'; // or 'signup'
    function openAuth(mode='login'){
      authMode = mode; authOverlay.style.display='flex'; authTitle.textContent = mode==='login' ? 'Login' : 'Signup';
      authSubmit.textContent = mode==='login' ? 'Login' : 'Create account';
      switchAuth.textContent = mode==='login' ? 'Switch to Signup' : 'Switch to Login';
      authEmail.value=''; authPassword.value='';
    }
    function closeAuth(){authOverlay.style.display='none'}

    btnLogin.addEventListener('click', ()=>openAuth('login'));
    btnGuest.addEventListener('click', ()=>{
      db.currentUser = null; saveDB(db); renderAll();
      alert('Continuing as Guest. Accounts are optional.');
    })

    switchAuth.addEventListener('click', ()=>{
      openAuth(authMode==='login' ? 'signup' : 'login');
    })

    authSubmit.addEventListener('click', ()=>{
      const name = authEmail.value.trim(); const pw = authPassword.value;
      if(!name || !pw){ alert('Please enter both username and password'); return; }
      if(authMode==='signup'){
        // check existing
        if(db.users.find(u=>u.name===name)){ alert('User exists, choose another name'); return; }
        db.users.push({id:genId(), name, password:pw, lists:[], prefs:{}});
        db.currentUser = name; saveDB(db); closeAuth(); renderAll(); return;
      }
      // login
      const u = db.users.find(u=>u.name===name && u.password===pw);
      if(!u){ alert('User not found or wrong password'); return; }
      db.currentUser = name; saveDB(db); closeAuth(); renderAll();
    })

    // --- lists UI ---
    addListBtn.addEventListener('click', ()=>{
      const name = prompt('New list name'); if(!name) return; const id = genId();
      db.lists[id] = {id,name,tasks:[]}; db.listOrder.push(id); saveDB(db); renderAll();
    })

    function renderListsSidebar(){
      listsContainer.innerHTML='';
      db.listOrder.forEach(id=>{
        const l = db.lists[id];
        const btn = document.createElement('button'); btn.textContent = l.name; btn.onclick = ()=>{filterByList(id)};
        listsContainer.appendChild(btn);
      });
    }

    function populateListSelect(){ taskListSelect.innerHTML=''; db.listOrder.forEach(id=>{
      const opt=document.createElement('option'); opt.value=id; opt.textContent=db.lists[id].name; taskListSelect.appendChild(opt);
    })}

    function filterByList(listId){ // show only that list
      renderAll(listId);
    }

    // --- tasks & drag/drop ---
    addTaskBtn.addEventListener('click', addTaskFromToolbar);
    taskText.addEventListener('keydown', (e)=>{ if(e.key==='Enter') addTaskFromToolbar(); })

    function addTaskFromToolbar(){
      const text = taskText.value.trim(); if(!text) return; const listId = taskListSelect.value;
      const task = {id:genId(), text, done:false, due: dueDate.value || null, created: new Date().toISOString()};
      db.lists[listId].tasks.push(task); saveDB(db); taskText.value=''; dueDate.value=''; renderAll();
    }

    function renderLists(filterListId=null, filterMode='all'){
      listsGrid.innerHTML='';
      db.listOrder.forEach(listId=>{
        if(filterListId && listId!==filterListId) return;
        const list = db.lists[listId];
        const col = document.createElement('div'); col.className='list card'; col.dataset.listId=listId;
        const h = document.createElement('h3');
        const title = document.createElement('div'); title.textContent = list.name + ' ('+list.tasks.length+')';
        const del = document.createElement('button'); del.textContent='â‹¯'; del.className='small-button ghost';
        del.onclick = ()=>{ if(confirm('Delete list? This will remove tasks.')){ delete db.lists[listId]; db.listOrder = db.listOrder.filter(x=>x!==listId); saveDB(db); renderAll(); }}
        h.appendChild(title); h.appendChild(del); col.appendChild(h);

        // tasks container
        const tasksWrap = document.createElement('div'); tasksWrap.className='tasks'; tasksWrap.ondragover = (e)=>{e.preventDefault(); e.dataTransfer.dropEffect='move'};
        tasksWrap.ondrop = (e)=>{
          const taskId = e.dataTransfer.getData('text/plain');
          const fromList = e.dataTransfer.getData('fromList');
          moveTask(taskId, fromList, listId);
        }

        list.tasks.forEach(task=>{
          // filtering
          if(filterMode==='today'){
            const td = task.due ? new Date(task.due).toDateString() : null;
            const today = new Date().toDateString(); if(td !== today) return;
          } else if(filterMode==='due_soon'){
            if(!task.due) return; const due = new Date(task.due); const now=new Date(); const diff=(due - now)/(1000*60*60*24);
            if(diff<0 || diff>7) return;
          }

          const t = document.createElement('div'); t.className='task'; t.draggable=true; t.dataset.taskId=task.id;
          t.addEventListener('dragstart', (e)=>{ t.classList.add('dragging'); e.dataTransfer.setData('text/plain', task.id); e.dataTransfer.setData('fromList', listId); });
          t.addEventListener('dragend', ()=>{ t.classList.remove('dragging'); saveDB(db); renderAll(); });

          const cb = document.createElement('input'); cb.type='checkbox'; cb.checked = task.done; cb.addEventListener('change', ()=>{ task.done = cb.checked; saveDB(db); renderAll(); });
          const titleDiv = document.createElement('div'); titleDiv.className='title'; titleDiv.innerHTML = '<strong>'+escapeHtml(task.text)+'</strong><div class="meta">Due: '+(task.due?formatDate(task.due):'â€”') + ' â€¢ Created: '+formatDate(task.created)+'</div>';
          const edit = document.createElement('button'); edit.textContent='âœŽ'; edit.className='small-button ghost'; edit.onclick = ()=>{ const nt=prompt('Edit task', task.text); if(nt!==null){ task.text=nt; saveDB(db); renderAll(); }}
          const delBtn = document.createElement('button'); delBtn.textContent='ðŸ—‘'; delBtn.className='small-button'; delBtn.onclick = ()=>{ if(confirm('Delete task?')){ list.tasks = list.tasks.filter(x=>x.id!==task.id); saveDB(db); renderAll(); }}

          t.appendChild(cb); t.appendChild(titleDiv); t.appendChild(edit); t.appendChild(delBtn);
          tasksWrap.appendChild(t);
        })

        // allow dropping at list bottom
        col.appendChild(tasksWrap);
        listsGrid.appendChild(col);
      })
    }

    function moveTask(taskId, fromListId, toListId){
      if(fromListId === toListId) return; const from = db.lists[fromListId]; const to = db.lists[toListId];
      const idx = from.tasks.findIndex(t=>t.id===taskId); if(idx===-1) return; const [task]=from.tasks.splice(idx,1); to.tasks.push(task); saveDB(db); renderAll();
    }

    // --- small helpers ---
    function escapeHtml(s){ return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

    // --- calendar ---
    calendarDate.addEventListener('change', ()=>{ renderCalendarList(calendarDate.value); });
    function renderCalendarList(date){ calendarList.innerHTML=''; if(!date) return; const picked = new Date(date).toDateString();
      let found=false; db.listOrder.forEach(id=>{
        db.lists[id].tasks.forEach(task=>{ if(task.due && new Date(task.due).toDateString()===picked){
          const el = document.createElement('div'); el.className='card'; el.style.marginTop='8px'; el.style.padding='8px'; el.textContent = db.lists[id].name + ': ' + task.text + ' ('+formatDate(task.due)+')'; calendarList.appendChild(el); found=true; }
        })
      })
      if(!found){ calendarList.innerHTML = '<div class="muted">No tasks on this date</div>' }
    }

    // --- quicklist buttons ---
    document.querySelectorAll('[data-quick]').forEach(b=>b.addEventListener('click', (e)=>{
      const q = e.target.dataset.quick; // create new list + some example tasks
      const id = genId(); db.lists[id] = {id,name:q+' List',tasks:[{id:genId(),text:q+' task 1',done:false,due:null,created:new Date().toISOString()}]}; db.listOrder.push(id); saveDB(db); renderAll();
    }))
    addQuick.addEventListener('click', ()=>{ const name=prompt('Quicklist name'); if(!name) return; const id=genId(); db.lists[id]={id,name,tasks:[]}; db.listOrder.push(id); saveDB(db); renderAll(); })

    // --- filters ---
    showAll.addEventListener('click', ()=>renderAll());
    showToday.addEventListener('click', ()=>renderAll(null,'today'));
    showDueSoon.addEventListener('click', ()=>renderAll(null,'due_soon'));

    // --- render main UI ---
    function renderAll(filterListId=null, filterMode='all'){
      db = loadDB(); // refresh
      renderListsSidebar(); populateListSelect(); renderLists(filterListId, filterMode);
      // user info
      if(db.currentUser){ displayName.textContent = db.currentUser; displayEmail.textContent = 'Signed in'; avatarText.textContent = db.currentUser[0].toUpperCase(); }
      else{ displayName.textContent = 'Guest'; displayEmail.textContent = 'Not signed in'; avatarText.textContent = 'G'; }
      // calendar
      renderCalendarList(calendarDate.value);
    }

    // init
    renderAll();

    // small helpful note: to support reordering within same list you'd add dragenter calculations and insertBefore. For demo we support moving between lists.

  </script>
</body>
</html>
